<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextStep | Premium Experience</title>
    <meta name="description"
        content="Plateforme premium connectant recruteurs et √©tudiants sur NextStep. D√©couvrez notre d√©mo.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
    <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script src="js/rome_database.js"></script>
    <script src="js/ollama_integration_complete.js"></script>
    <script src="js/france_travail_integration.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <div class="page-transition-overlay visible" id="page-loader"></div>
    <div class="particles-container" id="particles"></div>
    <div class="custom-cursor">
        <div class="cursor-visual"></div>
        <div class="cursor-label">Click !</div>
    </div>
    <div class="cursor-glow"></div>

    <nav class="side-nav">
        <a href="#start" class="side-dot active" title="Commencer"></a>
        <a href="#features" class="side-dot" title="Features"></a>
        <a href="#map-section" class="side-dot" title="Localisation"></a>
        <a href="#download" class="side-dot" title="T√©l√©charger"></a>
        <a href="#social" class="side-dot" title="Social"></a>
    </nav>

    <nav class="navbar">
        <div class="nav-links">
            <a href="#start" class="nav-item">Commencer</a>
            <a href="#features" class="nav-item">Features</a>
            <a href="#map-section" class="nav-item">Map</a>
            <a href="#download" class="nav-item">T√©l√©charger</a>
            <a href="#social" class="nav-item">Social</a>
        </div>
    </nav>

    <main class="container">
        <section id="start" class="actions">
            <h1 class="brand-title reveal">NextStep</h1>
            <p class="brand-desc reveal reveal-delay-1">La premi√®re plateforme d'orientation aliment√©e par <span
                    class="highlight-block">l'Intelligence Artificielle</span>.</p>
            <button id="btn-recruiter" class="btn btn-primary reveal reveal-delay-2">
                <div class="btn-content">
                    <span class="btn-title">Espace Recruteur</span>
                    <span class="btn-desc">G√©rez vos offres et trouvez les talents de demain.</span>
                </div>
                <span class="btn-action">D√©marrer</span>
                <span class="btn-glimmer"></span>
            </button>
            <button id="btn-student" class="btn btn-secondary reveal reveal-delay-2">
                <div class="btn-content">
                    <span class="btn-title">Espace √âtudiant</span>
                    <span class="btn-desc">Propulsez votre carri√®re avec des opportunit√©s uniques.</span>
                </div>
                <span class="btn-action">S'inscrire</span>
                <span class="btn-glimmer"></span>
            </button>
            <button id="btn-demo" class="btn btn-outline reveal reveal-delay-2">
                <div class="btn-content">
                    <span class="btn-title">Voir la D√©mo</span>
                    <span class="btn-desc">Visualisez l'exp√©rience NextStep en action.</span>
                </div>
                <span class="btn-action">D√©couvrir</span>
                <span class="btn-glimmer"></span>
            </button>
        </section>

        <div class="partners-section">
            <p class="partners-title">Ils nous aident √† d√©crypter les tendances du march√© (Stages & Alternances)</p>
            <div class="partners-grid">
                <div class="partners-track">
                    <!-- Set 1 -->
                    <div class="partner-logo">
                        <img src="logo/659bc13cdbd659a46cdb03c3_telaqua_horizontal_light.svg" alt="Telaqua">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/Image SVG.svg" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/o.webp" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/QQCfTYmBWM84GU83gcrgY0uQZl8.avif" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/6915ba1ac249dcac1e419498_Votre texte de ggfd-p-500.png" alt="Partner">
                    </div>

                    <!-- Set 2 (Duplicate for Loop) -->
                    <div class="partner-logo">
                        <img src="logo/659bc13cdbd659a46cdb03c3_telaqua_horizontal_light.svg" alt="Telaqua">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/Image SVG.svg" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/o.webp" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/QQCfTYmBWM84GU83gcrgY0uQZl8.avif" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/6915ba1ac249dcac1e419498_Votre texte de ggfd-p-500.png" alt="Partner">
                    </div>

                    <!-- Set 3 (Extra buffer) -->
                    <div class="partner-logo">
                        <img src="logo/659bc13cdbd659a46cdb03c3_telaqua_horizontal_light.svg" alt="Telaqua">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/Image SVG.svg" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/o.webp" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/QQCfTYmBWM84GU83gcrgY0uQZl8.avif" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/6915ba1ac249dcac1e419498_Votre texte de ggfd-p-500.png" alt="Partner">
                    </div>
                    <!-- Set 4 (Extra buffer) -->
                    <div class="partner-logo">
                        <img src="logo/659bc13cdbd659a46cdb03c3_telaqua_horizontal_light.svg" alt="Telaqua">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/Image SVG.svg" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/o.webp" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/QQCfTYmBWM84GU83gcrgY0uQZl8.avif" alt="Partner">
                    </div>
                    <div class="partner-logo">
                        <img src="logo/6915ba1ac249dcac1e419498_Votre texte de ggfd-p-500.png" alt="Partner">
                    </div>
                </div>
            </div>
        </div>

        <div class="separator">
            <div class="separator-line"></div>
            <div class="separator-dot"></div>
            <div class="separator-line"></div>
        </div>

        <section id="features" class="features">
            <div class="feature-card reveal reveal-delay-1">
                <div class="feature-visual">
                    <img src="assets/icons/Capture_decran_2026-02-02_a_18.17.31 (2).png" alt="Carte de matching">
                </div>
                <div class="feature-info">
                    <h2 class="feature-title">Pathfinder</h2>
                    <p class="feature-desc">Une carte propuls√©e par l'IA pour localiser instantan√©ment les meilleures
                        alternances adapt√©es √† votre profil.</p>
                </div>
            </div>
            <div class="feature-card reveal reveal-delay-2">
                <div class="feature-visual centered-icon">
                    <img src="assets/icons/ai.png" alt="Statistiques">
                </div>
                <div class="feature-info">
                    <h2 class="feature-title">Assistant IA de Carri√®re</h2>
                    <p class="feature-desc">Votre assistant personnel intelligent vous guide vers les meilleurs
                        employeurs pour garantir votre succ√®s.</p>
                </div>
            </div>
            <div class="feature-card reveal reveal-delay-3">
                <div class="feature-visual centered-icon">
                    <img src="assets/icons/chat.png" alt="Support Chat">
                </div>
                <div class="feature-info">
                    <h2 class="feature-title">Connexion Directe</h2>
                    <p class="feature-desc">√âtudiants et recruteurs communiquent sans barri√®re pour des √©changes fluides
                        sur vos stages et alternances.</p>
                </div>
            </div>
            <div class="feature-card full-width reveal reveal-delay-4">
                <div class="stat-display">
                    <span class="stat-value" data-target="985400">0</span>
                    <span class="stat-unit">Demandes d'alternance</span>
                </div>
                <div class="feature-info">
                    <h2 class="feature-title">Flux d'Opportunit√©s</h2>
                    <p class="feature-desc">Connectez-vous au plus grand r√©seau de recrutement √©tudiant en temps r√©el.
                        Chaque chiffre repr√©sente une future collaboration r√©ussie.</p>
                </div>
            </div>
        </section>

        <div class="separator">
            <div class="separator-line"></div>
            <div class="separator-dot"></div>
            <div class="separator-line"></div>
        </div>

        <section id="map-section" class="map-section reveal">
            <div class="feature-info" style="text-align: center; margin-bottom: 2rem;">
                <h2 class="feature-title system-title">Pathfinder</h2>
                <p class="feature-desc">Connectez-vous aux opportunit√©s partout dans le monde.</p>
            </div>
            <div id="map" class="map-container" data-lenis-prevent></div>
        </section>

        <div class="separator reveal">
            <div class="separator-line"></div>
            <div class="separator-dot"></div>
            <div class="separator-line"></div>
        </div>

        <section id="download" class="download-section reveal">
            <div class="feature-info" style="text-align: center; margin-bottom: 3rem;">
                <h2 class="brand-title"
                    style="font-size: 4rem; margin-bottom: 1rem; display: block; text-align: center; width: 100%;">Notre
                    Extension</h2>
                <h3 class="feature-title" style="font-size: 1.5rem; opacity: 0.8;">Disponible partout</h3>
                <p class="feature-desc">Emportez votre carri√®re avec vous. T√©l√©chargez l'extension NextStep.</p>
            </div>
            <div class="download-buttons" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <!-- Chrome (Active) -->
                <button class="btn btn-primary btn-download"
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; padding: 8px 20px;">
                    <img src="assets/icons/chrome.png" alt="Chrome" style="width: 24px; height: 24px;">
                    <div style="text-align: left; line-height: 1.2;">
                        <span style="font-size: 10px; opacity: 0.8; display: block;">Disponible sur</span>
                        <span style="font-size: 14px; font-weight: 600;">Chrome Web Store</span>
                    </div>
                </button>

                <!-- Firefox (Soon) -->
                <button class="btn btn-primary btn-download"
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; padding: 8px 20px; opacity: 0.4; pointer-events: none; border-color: rgba(255,255,255,0.1) !important;">
                    <img src="assets/icons/firefox.png" alt="Firefox" style="width: 24px; height: 24px;">
                    <div style="text-align: left; line-height: 1.2;">
                        <span style="font-size: 10px; opacity: 0.8; display: block;">Bient√¥t sur</span>
                        <span style="font-size: 14px; font-weight: 600;">Firefox Add-ons</span>
                    </div>
                </button>

                <!-- Safari (Soon) -->
                <button class="btn btn-primary btn-download"
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; padding: 8px 20px; opacity: 0.4; pointer-events: none; border-color: rgba(255,255,255,0.1) !important;">
                    <img src="assets/icons/safari.png" alt="Safari" style="width: 24px; height: 24px;">
                    <div style="text-align: left; line-height: 1.2;">
                        <span style="font-size: 10px; opacity: 0.8; display: block;">Bient√¥t sur</span>
                        <span style="font-size: 14px; font-weight: 600;">Safari Web</span>
                    </div>
                </button>
            </div>
        </section>

        <div class="separator reveal">
            <div class="separator-line"></div>
            <div class="separator-dot"></div>
            <div class="separator-line"></div>
        </div>

        <section id="social" class="social-section">
            <div class="feature-info reveal" style="text-align: center; margin-bottom: 3rem;">
                <h2 class="feature-title">Alertes Instantan√©es</h2>
                <p class="feature-desc">Recevez les meilleures offres en temps r√©el sur votre application favorite.</p>
            </div>
            <div class="social-grid">
                <div class="social-card reveal reveal-delay-1">
                    <div class="social-icon">
                        <img src="assets/icons/discord.png" alt="Discord">
                    </div>
                    <div class="social-info">
                        <h3>Discord</h3>
                        <p>Rejoignez notre serveur pour des alertes cibl√©es.</p>
                    </div>
                </div>
                <div class="social-card reveal reveal-delay-2">
                    <div class="social-icon">
                        <img src="assets/icons/whatsapp.png" alt="WhatsApp">
                    </div>
                    <div class="social-info">
                        <h3>WhatsApp</h3>
                        <p>Recevez une notification directe sur votre mobile.</p>
                    </div>
                </div>
                <div class="social-card reveal reveal-delay-3">
                    <div class="social-icon">
                        <img src="assets/icons/telegram.png" alt="Telegram">
                    </div>
                    <div class="social-info">
                        <h3>Telegram</h3>
                        <p>Un flux ultra-rapide et s√©curis√© pour vos offres.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-canvas-container">
            <svg id="connection-lines" class="connection-svg"></svg>
        </div>
        <div class="footer-content">
            <h2 class="footer-brand reveal">NextStep</h2>
            <p class="footer-copyright">¬© 2026 NextStep. Tous droits r√©serv√©s.</p>
        </div>
    </footer>

    <!-- Custom Modal -->
    <div id="discord-modal" class="modal-overlay">
        <div class="modal-card">
            <button class="modal-close">&times;</button>
            <div class="modal-body" style="margin-bottom: 0;">
                <p class="modal-desc">Voici un aper√ßu de l'alerte que vous recevrez instantan√©ment d√®s qu'une nouvelle
                    offre est publi√©e sur le r√©seau.</p>
                <div class="embed-container">
                    <div class="discord-embed">
                        <div class="embed-pill"></div>
                        <div class="embed-content">
                            <div class="embed-author">
                                <span class="author-name">NextStep Bot</span>
                            </div>
                            <div class="embed-title">Nouvelle offre : D√©veloppeur Web (H/F)</div>
                            <div class="embed-description">Une opportunit√© exceptionnelle en alternance au c≈ìur de
                                Marseille. Profil junior accept√© avec bases en JS.</div>
                            <div class="embed-fields">
                                <div class="embed-field">
                                    <div class="field-name">üìç Lieu</div>
                                    <div class="field-value">Marseille (13)</div>
                                </div>
                                <div class="embed-field">
                                    <div class="field-name">üí∞ R√©mun√©ration</div>
                                    <div class="field-value">1100‚Ç¨ - 1400‚Ç¨ / mois</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="embed-actions">
                        <button class="embed-btn">Postuler</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo Selection Screen -->
    <div id="demo-selection" class="demo-overlay">
        <div class="demo-content">
            <div class="demo-options">
                <div class="choice-card" id="choice-recruiter">
                    <h3>Recruteur</h3>
                    <p>Je recherche des talents</p>
                </div>
                <div class="choice-card" id="choice-student">
                    <h3>√âtudiant</h3>
                    <p>Je cherche une opportunit√©</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Demo Map Modal -->
    <div id="student-demo-modal" class="modal-overlay"
        style="z-index: 200000; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); align-items: stretch; justify-content: flex-start; padding: 0;">
        <!-- Main Content Wrapper (Left Sidebar + Map) -->
        <div class="student-main-content" data-lenis-prevent
            style="flex: 1; display: flex; flex-direction: column; margin: 0; height: 100%; border: none; border-right: none; border-radius: 0; overflow: hidden; box-shadow: none; background: rgba(10, 10, 10, 0.65); backdrop-filter: blur(20px);">

            <!-- Content Area (Sidebar + Map) -->
            <div class="student-content-area" style="flex: 1; display: flex; overflow: hidden;">
                <div class="student-left-sidebar" data-lenis-prevent
                    style="width: 380px; background-color: #121212; border-right: 1px solid rgba(255,255,255,0.05); position: relative; z-index: 1; display: flex; flex-direction: column; overflow: hidden;">

                    <!-- Header -->
                    <div
                        style="padding: 1rem 0.8rem; display: flex; align-items: center; justify-content: center; position: relative;">
                        <i id="close-student-demo-arrow" class="fa-solid fa-arrow-left"
                            style="font-size: 16px; color: white; opacity: 0.8; cursor: pointer; position: absolute; left: 0.8rem; z-index: 10; padding: 10px; margin-left: -10px; transition: all 0.2s;"></i>
                        <h1 class="brand-title"
                            style="font-size: 1.8rem; letter-spacing: -1px; margin: 0; filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3)); width: 100%; text-align: center; pointer-events: none;">
                            NextStep
                        </h1>
                        <!-- Add click listener to arrow in script.js by ID reuse or new ID -->
                    </div>

                    <!-- PDF Drop Zone & Results Container -->
                    <div style="flex: 1; display: flex; flex-direction: column; min-height: 0; overflow: hidden;">
                        <div class="pdf-drop-zone" id="drop-zone"
                            style="height: 200px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #151515; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); position: relative; overflow: hidden; margin: 0 1.5rem 1rem 1.5rem;">
                            <input type="file" id="cv-upload" accept=".pdf" style="display: none;">
                            <!-- Animated Background Glow -->
                            <div class="drop-glow"
                                style="position: absolute; width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(255, 255, 255, 0.15), transparent 70%); opacity: 0; transition: opacity 0.3s ease;">
                            </div>

                            <div class="icon-container"
                                style="width: 48px; height: 48px; background: rgba(255,255,255,0.05); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; border: 1px solid rgba(255,255,255,0.05); z-index: 2;">
                                <i class="fa-solid fa-file-arrow-up" style="font-size: 1.2rem; color: #e0e0e0;"></i>
                            </div>

                            <h3
                                style="color: white; font-size: 0.95rem; font-weight: 500; margin-bottom: 0.4rem; z-index: 2;">
                                D√©posez votre CV</h3>
                            <p style="color: var(--text-secondary); font-size: 0.8rem; text-align: center; z-index: 2;">
                                PDF uniquement (Max 5Mo)</p>

                            <style>
                                .pdf-drop-zone.locked {
                                    cursor: not-allowed;
                                }

                                .pdf-drop-zone:hover {
                                    border-color: rgba(255, 255, 255, 0.4) !important;
                                    transform: translateY(-2px);
                                    box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
                                }

                                .pdf-drop-zone:hover .drop-glow {
                                    opacity: 1 !important;
                                }

                                .pdf-drop-zone:hover .icon-container {
                                    background: rgba(255, 255, 255, 0.1) !important;
                                    border-color: rgba(255, 255, 255, 0.2) !important;
                                }

                                #offers-list::-webkit-scrollbar {
                                    width: 4px;
                                }

                                #offers-list::-webkit-scrollbar-track {
                                    background: transparent;
                                }

                                #offers-list::-webkit-scrollbar-thumb {
                                    background: rgba(255, 255, 255, 0.1);
                                    border-radius: 10px;
                                }

                                #offers-list::-webkit-scrollbar-thumb:hover {
                                    background: rgba(255, 255, 255, 0.2);
                                }
                            </style>
                        </div>

                        <!-- Search Type Filter (Visible initially) -->
                        <div id="search-type-selection" style="padding: 0 1.5rem 1rem 1.5rem;">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 8px;">
                                <span class="filter-label"
                                    style="color: rgba(255,255,255,0.3); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; padding-left: 4px;">Je
                                    recherche :</span>
                                <div class="custom-dropdown" id="dropdown-search-type">
                                    <div class="dropdown-trigger">
                                        <span class="trigger-label">Alternance</span>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="option" data-value="ecole">√âcole</div>
                                        <div class="option selected" data-value="alternance">Alternance</div>
                                        <div class="option" data-value="stage">Stage</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Secondary Filter: Private/Public (Conditional) -->
                        <div id="school-type-selection" style="padding: 0 1.5rem 1rem 1.5rem; display: none;">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 8px;">
                                <span class="filter-label"
                                    style="color: rgba(255,255,255,0.3); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; padding-left: 4px;">Type
                                    d'√©tablissement :</span>
                                <div class="custom-dropdown" id="dropdown-school-type">
                                    <div class="dropdown-trigger">
                                        <span class="trigger-label">Priv√©</span>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="option selected" data-value="prive">Priv√©</div>
                                        <div class="option" data-value="publique">Publique</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Third Filter: Lyc√©e/Fac (Conditional) -->
                        <div id="school-level-selection" style="padding: 0 1.5rem 1rem 1.5rem; display: none;">
                            <div class="filter-group" style="display: flex; flex-direction: column; gap: 8px;">
                                <span class="filter-label"
                                    style="color: rgba(255,255,255,0.3); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; padding-left: 4px;">Niveau
                                    d'√©tude :</span>
                                <div class="custom-dropdown" id="dropdown-school-level">
                                    <div class="dropdown-trigger">
                                        <span class="trigger-label">Lyc√©e</span>
                                        <i class="fa-solid fa-chevron-down"></i>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="option selected" data-value="lycee">Lyc√©e</div>
                                        <div class="option" data-value="fac">Fac</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CV Results (Hidden initially) -->
                        <div id="cv-results-container" class="hidden" data-lenis-prevent
                            style="padding: 1.5rem 0 0 0; display: flex; flex-direction: column; gap: 1rem; flex: 1; min-height: 0; overflow: hidden;">
                            <h4
                                style="color: rgba(255,255,255,0.7); font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 0.5rem; text-align: center; width: 100%;">
                                R√©sultat</h4>

                            <!-- Custom Filters -->
                            <div class="results-filters"
                                style="padding: 0 1rem; display: flex; gap: 12px; flex-shrink: 0;">

                                <!-- Status Filter -->
                                <div class="filter-group"
                                    style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
                                    <span class="filter-label"
                                        style="color: rgba(255,255,255,0.3); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; padding-left: 4px;">Statut
                                        :</span>
                                    <div class="custom-dropdown" id="dropdown-status">
                                        <div class="dropdown-trigger">
                                            <span class="trigger-label">Tous</span>
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </div>
                                        <div class="dropdown-options">
                                            <div class="option" data-value="all">Tous</div>
                                            <div class="option" data-value="open">Ouvert</div>
                                            <div class="option" data-value="closed">Ferm√©</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sort Filter -->
                                <div class="filter-group"
                                    style="flex: 1; display: flex; flex-direction: column; gap: 8px;">
                                    <span class="filter-label"
                                        style="color: rgba(255,255,255,0.3); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; padding-left: 4px;">Score
                                        :</span>
                                    <div class="custom-dropdown" id="dropdown-sort">
                                        <div class="dropdown-trigger">
                                            <span class="trigger-label">D√©croissant</span>
                                            <i class="fa-solid fa-chevron-down"></i>
                                        </div>
                                        <div class="dropdown-options">
                                            <div class="option" data-value="desc">D√©croissant</div>
                                            <div class="option" data-value="asc">Croissant</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="offers-list" data-lenis-prevent
                                style="display: flex; flex-direction: column; gap: 0.8rem; overflow-y: auto; flex: 1; padding: 0 1.5rem 2rem 1.5rem; scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.1) transparent; pointer-events: auto !important; touch-action: pan-y !important;">
                                <!-- Offers will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map Area -->
                <div id="student-demo-map"
                    style="flex: 1; position: relative; overflow: hidden; border-radius: 0; margin-left: 0;">



                    <!-- Location Permission Overlay -->
                    <div id="location-prompt-overlay" class="map-overlay" style="z-index: 100;">
                        <div class="permission-card">
                            <div class="icon-circle">
                                <i class="fa-solid fa-location-crosshairs"></i>
                            </div>
                            <h3>Localisation requise</h3>
                            <p>Pour vous proposer les meilleures offres √† proximit√©, NextStep a besoin d'acc√©der √† votre
                                position actuelle.</p>
                            <button id="btn-allow-location" class="btn-nav"
                                style="padding: 12px 30px; font-size: 0.9rem;">Autoriser l'acc√®s</button>
                        </div>
                    </div>

                    <div id="map-scan-overlay" class="map-overlay hidden">
                        <div class="apple-style-search">
                            <div class="minimal-loader"></div>
                            <h3>Analyse en cours</h3>
                            <p>Optimisation des r√©sultats par l'IA</p>
                        </div>
                    </div>

                    <!-- Company Detail Popup (Centered on Map) -->
                    <div id="company-detail-popup" class="map-overlay hidden">
                        <div class="company-detail-card">
                            <i id="close-company-detail" class="fa-solid fa-xmark close-detail"
                                onclick="document.getElementById('company-detail-popup').classList.add('hidden')"></i>
                            <div class="detail-header">
                                <div id="detail-logo" class="detail-logo"></div>
                                <div class="detail-title-group">
                                    <h2 id="detail-company-name">Company Name</h2>
                                    <p id="detail-role-name">Role Name</p>
                                </div>
                            </div>

                            <!-- Detail Navbar -->
                            <div class="detail-navbar">
                                <button class="nav-item active" data-tab="info">Information</button>
                                <button class="nav-item" data-tab="analysis">Analyse</button>
                            </div>

                            <div class="detail-body">
                                <div id="tab-info" class="tab-content">
                                    <div class="detail-meta">
                                        <div class="meta-item">
                                            <i class="fa-solid fa-location-dot"></i>
                                            <span id="detail-distance">1.2 km</span>
                                        </div>
                                        <div class="meta-item">
                                            <i class="fa-solid fa-clock"></i>
                                            <span id="detail-contract">Apprentissage</span>
                                        </div>
                                        <div class="meta-item">
                                            <i class="fa-solid fa-map-pin"></i>
                                            <span id="detail-city">Marseille</span>
                                        </div>
                                    </div>
                                    <div class="detail-section">
                                        <h4>√Ä Propos</h4>
                                        <p id="detail-description">Description of the company and the mission...</p>
                                    </div>
                                    <div class="detail-section">
                                        <h4>Recherche</h4>
                                        <p id="detail-requirements">What they are looking for precisely...</p>
                                    </div>
                                </div>
                                <div id="tab-analysis" class="tab-content hidden">
                                    <div class="detail-section">
                                        <h4>Analyse IA Predictive</h4>
                                        <p>Score de compatibilit√© : <span
                                                style="color: #3b82f6; font-weight: 700;">94%</span></p>
                                        <p style="margin-top: 10px;">Bas√© sur vos comp√©tences en React et votre
                                            proximit√© g√©ographique.</p>
                                    </div>
                                    <div class="detail-section">
                                        <h4>Points Forts</h4>
                                        <ul
                                            style="color: rgba(255,255,255,0.7); font-size: 0.9rem; padding-left: 20px;">
                                            <li>Expertise technique valid√©e</li>
                                            <li>Localisation id√©ale (15min)</li>
                                            <li>Match culture d'entreprise</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="detail-footer">
                                    <button class="btn-nav apply-btn"
                                        onclick="showNotification('Candidature envoy√©e avec succ√®s !'); document.getElementById('company-detail-popup').classList.add('hidden')">Postuler
                                        maintenant</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT SIDEBAR (Chatbot) -->
                <div class="student-right-sidebar" data-lenis-prevent
                    style="width: 380px; background-color: #121212; border-left: 1px solid rgba(255,255,255,0.05); position: relative; z-index: 1; display: flex; flex-direction: column; overflow: hidden;">

                    <!-- Chat Header -->
                    <div
                        style="padding: 1rem 0.8rem; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid rgba(255,255,255,0.05); background: rgba(20, 20, 20, 0.5);">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div
                                style="width: 28px; height: 28px; background: #6366f1; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">
                                <i class="fa-solid fa-robot"></i>
                            </div>
                            <div>
                                <h3 style="margin: 0; font-size: 14px; font-weight: 600;">Assistant NextStep</h3>
                                <span style="font-size: 10px; color: #10b981;">‚óè En ligne</span>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div id="chat-messages"
                        style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scrollbar-width: none;">
                        <div
                            style="align-self: flex-start; background: rgba(255,255,255,0.05); padding: 12px 18px; border-radius: 12px; border-bottom-left-radius: 2px; max-width: 85%; font-size: 13px; color: #e2e8f0; line-height: 1.5;">
                            Bonjour ! Je suis votre assistant carri√®re. Cliquez sur une offre pour que je puisse
                            l'analyser avec vous ! üöÄ
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div
                        style="padding: 15px; border-top: 1px solid rgba(255,255,255,0.05); background: rgba(15, 15, 15, 0.8);">
                        <div style="position: relative; display: flex; gap: 8px;">
                            <textarea id="chat-input" placeholder="Posez une question..." rows="1"
                                style="flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px 15px; color: white; resize: none; font-family: inherit; font-size: 13px; outline: none; transition: border-color 0.2s;"></textarea>
                            <button id="chat-send-btn"
                                style="width: 42px; height: 42px; background: #6366f1; border: none; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s;">
                                <i class="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Toast Notification Container -->
        <div id="toast-container" class="toast-notification">
            <div class="toast-icon">
                <i class="fa-solid fa-check"></i>
            </div>
            <div class="toast-text">
                <h4>Analyse termin√©e</h4>
                <p id="toast-message">3 opportunit√©s trouv√©es √† Marseille.</p>
            </div>
        </div>

        <!-- AI elements removed -->

        <!-- CV Analysis Results Popup -->
        <div id="cv-analysis-popup" class="cv-analysis-modal hidden">
            <div class="cv-analysis-overlay"></div>
            <div class="cv-analysis-card">
                <button class="cv-analysis-close" id="close-cv-analysis">
                    <i class="fa-solid fa-xmark"></i>
                </button>

                <div id="cv-analysis-content">
                    <!-- Content will be injected by JavaScript -->
                </div>
            </div>
        </div>



        <!-- Dashboard has been moved to dashboard.html -->
        <script src="js/schools_db.js"></script>
        <!-- AI Match Popup Logic -->
        <script src="js/ai_match_popup.js"></script>
        <script src="js/script.js"></script>

        <!-- FORCE CHAT LISTENERS (Capture Phase) -->
        <!-- SELF-CONTAINED CHATBOT LOGIC -->
        <script>
            console.log("üöÄ Chatbot Logic Initializing...");
            let activeOfferCtx = null;
            let chatHistory = []; // Conversation memory

            // Inject styles for mentions
            const style = document.createElement('style');
            style.innerHTML = `
                .mention {
                    color: #818cf8;
                    background: rgba(99, 102, 241, 0.15);
                    padding: 2px 6px;
                    border-radius: 4px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                .mention:hover {
                    background: rgba(99, 102, 241, 0.3);
                    text-decoration: underline;
                }
            `;
            document.head.appendChild(style);

            function formatMentions(text) {
                // Regex to find @Name (simple word boundary)
                return text.replace(/@(\w+)/g, '<span class="mention">@$1</span>');
            }

            function addAiChatMessage(role, text) {
                const aiChatMessages = document.getElementById('chat-messages');
                if (!aiChatMessages) return;

                const msg = document.createElement('div');
                const isAssistant = role === 'assistant';

                msg.style.alignSelf = isAssistant ? 'flex-start' : 'flex-end';
                msg.style.background = isAssistant ? 'rgba(255,255,255,0.05)' : '#6366f1';
                msg.style.padding = '12px 18px';
                msg.style.borderRadius = '12px';
                if (isAssistant) msg.style.borderBottomLeftRadius = '2px';
                else msg.style.borderBottomRightRadius = '2px';
                msg.style.maxWidth = '85%';
                msg.style.fontSize = '14px';
                msg.style.color = isAssistant ? '#e2e8f0' : 'white';
                msg.style.lineHeight = '1.5';

                // Format mentions
                msg.innerHTML = formatMentions(text);

                aiChatMessages.appendChild(msg);
                aiChatMessages.scrollTop = aiChatMessages.scrollHeight;

                chatHistory.push({ role: role, content: text });
                if (chatHistory.length > 20) chatHistory = chatHistory.slice(-20);
            }

            window.sendAiChatMessage = async function () {
                const aiChatInput = document.getElementById('chat-input');
                const aiChatSendBtn = document.getElementById('chat-send-btn');

                if (!aiChatInput) return;
                const text = aiChatInput.value.trim();

                console.log("Sending message:", text); // Debug log
                if (!text) return;

                addAiChatMessage('user', text);
                aiChatInput.value = '';
                aiChatInput.disabled = true;

                // 1. Build Base Context (Offer + CV)
                let contextPrompt = "";
                if (activeOfferCtx) {
                    contextPrompt += `[OFFRE ACTUELLE: Entreprise=${activeOfferCtx.company}, Poste=${activeOfferCtx.role}] `;
                    if (activeOfferCtx.desc) contextPrompt += `[DESC: ${activeOfferCtx.desc}] `;
                    if (activeOfferCtx.req) contextPrompt += `[REQUIS: ${activeOfferCtx.req}] `;
                }

                if (window.userCVContent) {
                    contextPrompt += ` [CV DU CANDIDAT: ${window.userCVContent.substring(0, 3000)}...] `;
                }

                // 2. Handle Mentions (@Company) and Intentions
                const mentionMatch = text.match(/@(\w+)/);
                if (mentionMatch) {
                    const companyName = mentionMatch[1];
                    console.log("Mention detected:", companyName);

                    // Lookup
                    if (window.studentOffersData) {
                        const found = window.studentOffersData.find(o => o.company.toLowerCase().includes(companyName.toLowerCase()));
                        if (found) {
                            // INJECT RICH CONTEXT
                            contextPrompt += ` [FOCUS CIBL√â SUR @${found.company.toUpperCase()}: 
                             - Description: ${found.desc || "Non sp√©cifi√©e"}
                             - Pr√©-requis: ${found.req || "Non sp√©cifi√©s"}
                             - Ville: ${found.city || "Non sp√©cifi√©e"}] `;
                        }
                    }

                    // Detect Intentions
                    const lowerText = text.toLowerCase();
                    if (lowerText.includes("parle moi") || lowerText.includes("c'est quoi") || lowerText.includes("d√©tails")) {
                        contextPrompt += " [ACTION: Pr√©sente l'entreprise de mani√®re attractive. Utilise la description fournie.] ";
                    }
                    else if (lowerText.includes("avantage") || lowerText.includes("mon cv") || lowerText.includes("pourquoi moi") || lowerText.includes("chances")) {
                        contextPrompt += " [ACTION CRITIQUE: Analyse le CV par rapport aux PRE-REQUIS de cette offre. Liste les points de compatibilit√© (Hard & Soft Skills). Sois un coach strat√©gique.] ";
                    }
                }

                // 3. Prepare Payload with History
                const conversationPayload = chatHistory.slice(0, -1);
                conversationPayload.push({ role: "user", content: contextPrompt + "\n\nMessage utilisateur: " + text });

                const systemMsg = {
                    role: "system",
                    content: "Tu es l'Expert Carri√®re NextStep. TA MISSION : Coacher l'√©tudiant vers l'alternance. \n- Si on te demande de pr√©senter une entreprise : Sois complet, valorisant et pr√©cis.\n- Si on te demande 'mes avantages' ou une analyse : Croise les donn√©es du CV avec l'offre. Donne des arguments concrets.\n- Ton ton est professionnel, encourageant et expert."
                };

                try {
                    const resp = await fetch('http://localhost:8000/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: "llama3.2",
                            messages: [systemMsg, ...conversationPayload],
                            stream: false
                        })
                    });
                    const data = await resp.json();
                    addAiChatMessage('assistant', data.choices ? data.choices[0].message.content : "R√©ponse invalide du backend.");
                } catch (e) {
                    console.error("Chat Error:", e);
                    addAiChatMessage('assistant', "Erreur de connexion au serveur IA.");
                } finally {
                    aiChatInput.disabled = false;
                    aiChatInput.focus();
                }
            };

            // Global context updater
            window.updateChatbotContext = function (offer) {
                activeOfferCtx = offer;
                const aiChatMessages = document.getElementById('chat-messages');
                if (aiChatMessages) {
                    aiChatMessages.innerHTML = '';
                    addAiChatMessage('assistant', `Bonjour ! Parlons de l'offre chez <strong>${offer.company}</strong>.`);
                }
            };

            // Event Listeners (Capture Phase)
            document.addEventListener('keydown', function (e) {
                if (e.target.id === 'chat-input' && e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    window.sendAiChatMessage();
                    return false;
                }
            }, true);

            document.addEventListener('click', function (e) {
                if (e.target.closest('#chat-send-btn')) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    window.sendAiChatMessage();
                    return false;
                }
            }, true);
        </script>
</body>

</html>